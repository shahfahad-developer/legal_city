# LEGAL CITY FULL STACK DIAGNOSTIC & GOOGLE AUTH UPGRADE

You are working on a React + Node.js (Express + MySQL) full stack project called “Legal City.”
Your job is to act like a senior full-stack engineer and QA bot that analyzes, repairs, and extends this system end-to-end.

### Step 1: Backend Verification
1. Open the backend folder.
2. Check all routes in `/routes` → ensure `auth.js`, `lawyers.js`, and `admin.js` match their respective controllers.
3. Run `npm run dev` and analyze logs.
4. Fix any missing imports, syntax errors, or undefined controller calls.
5. Identify source of “501 Failed to Load Stats” in Admin Dashboard API (likely `/api/admin/stats`).
   - Implement `getStats` controller in `adminController.js` that returns summarized data (users count, lawyers count, verified/unverified, etc.).
   - Add `/admin/stats` GET route returning JSON summary.

### Step 2: Google Authentication Role Split
1. In `frontend/src/components/auth/Login.jsx`, modify Google login section:
   - Add two buttons:
     - `Continue with Google as User`
     - `Continue with Google as Lawyer`
   - Each button should append a query param: `?role=user` or `?role=lawyer` when redirecting to `/api/auth/google`.

2. In backend `/config/passport.js`, modify Google Strategy:
   - Capture the `role` from query params.
   - On successful OAuth callback:
     - If `role=user` → store record in `users` table.
     - If `role=lawyer` → store record in `lawyers` table.
   - Mark `email_verified = 1` and prefill `name`, `email`, `google_id`.
   - For incomplete profiles, add flag `profile_completed = 0`.

3. After successful login:
   - Redirect:
     - `/google-user-setup?token=<jwt>` → for user
     - `/google-lawyer-setup?token=<jwt>` → for lawyer

### Step 3: Google Setup Pages
1. Create two new pages:
   - `src/pages/GoogleUserSetup.jsx`
   - `src/pages/GoogleLawyerSetup.jsx`
2. Each should:
   - Use `useAuth()` context to detect token.
   - Fetch `/auth/me` to load prefilled info.
   - Show editable form for missing fields (city, address, mobile, etc.).
   - Buttons:
     - `Continue` → sends PUT `/auth/me` update.
     - `Submit Later` → navigate to `/dashboard` (or `/admin` if admin).

### Step 4: Validation and Testing
1. Run full local integration test:
   - Normal login/register
   - OTP verification
   - Password reset
   - Google OAuth (both user and lawyer)
   - Admin stats
2. Confirm all API calls return proper HTTP status and no console errors.

### Step 5: Final QA & Optimization
1. Clean unused imports in frontend.
2. Verify `.env` URLs match (`http://localhost:5001` backend, `http://localhost:3000` frontend).
3. Ensure consistent token validation in all Axios calls.
4. Commit changes to new branch `feature/google-auth-split`.
5. Generate summary report of issues fixed and endpoints verified.